<?xml version="1.0" encoding="UTF-8" ?>
<Module>
  <ModulePrefs title="Fetch JSON Example"/>
  <Content type="html">
  <![CDATA[
        <link rel="stylesheet" type="text/css" href="https://dl.dropbox.com/u/84602525/agile-grenoble-backend/program.css" />
        <table cellpadding="0" cellspacing="0" class="program">
            <thead>
                <tr>
                    <th>Auditorium</th>
                    <th>Makalu</th>
                    <th>Kilimandjaro&nbsp;1</th>
                    <th>Kilimandjaro&nbsp;3</th>
                    <th>Mont&nbsp;Blanc&nbsp;1</th>
                    <th>Mont&nbsp;Blanc&nbsp;3</th>
                    <th>Mont&nbsp;Blanc&nbsp;4</th>
                    <th>Cervin</th>
                    <th>Evrest</th>
                </tr>
            </thead>
            <tbody id="program_content">
            </tbody>
        </table>

        <div id="content_div2"></div>

        
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
    <script type="text/javascript">

    function makeJSONRequest() {    
      var params = {};
      params[gadgets.io.RequestParameters.CONTENT_TYPE] = gadgets.io.ContentType.JSON;
      // This URL returns a JSON-encoded string that represents a JavaScript object
      //var url = "https://dl.dropbox.com/u/84602525/agile-grenoble-backend/program.json";
      var url = "http://sessions.agile-grenoble.org:8080/json/program-summary-with-roomlist";
      gadgets.io.makeRequest(url, response, params);
    };

    function response(obj) { 
      var program = obj.data;
      
var room_map = {
    "Auditorium":0,
    "Makalu":1,  
    "Kilimanjaro 1": 2,
    "Kilimanjaro 3": 3,
    "Mont Blanc 1": 4,
    "Mont Blanc 3+2": 5,
    "Mont Blanc 4": 6,
    "Cervin": 7,
    "Everest": 8
};

var slot_id = 0;    
$.each(program["slots"], function(islot, slot) {
    var session_html = '';
    if (slot.all) {
        // there is only one key
        $.each(slot, function (room, slot) {
            session_html += '<td colspan="9" class="plenary">'+slot['title']+'</td>';
        });
        $('#program_content').append('<tr>'+session_html+'</tr>');
    } else {
        //var room_map = {};
        //var room_nb = 0;
        $.each(room_map, function (room, room_id) {
            //room_map[room] = room_nb;
            session_html += '<td id="'+slot_id+'_'+room_id+'">&nbsp;</td>';
            //room_nb++;
        });
        $('#program_content').append('<tr>'+session_html+'</tr>');

        $.each(slot, function (room, session) {
            session_content = '';
            session_content += '<span class="session_title">'+session['title']+'</span> ';
            if (session['speakers']) {
                session_content += '<span class="session_speakers">'+session['speakers'].join(', ')+'</span>';
            }
            $('#'+slot_id+'_'+room_map[room]).append(session_content);
        });
    }
    slot_id++;
});
   };
     
     gadgets.util.registerOnLoadHandler(makeJSONRequest);
     </script>
  ]]>
  </Content>
</Module>
