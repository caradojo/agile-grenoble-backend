var program = {"rooms":["Auditorium","Kilimanjaro 1","Mont Blanc 1","Kilimanjaro 3","Mont Blanc 4","Everest","Cervin","Mont Blanc 3+2","Makalu"],"slots":[{"all":{"title":"Accueil des participants autour d'un café", "type":"arrival"}},{"all":{"title":"Session Plénière: le mot des organisateurs & Sogilis"}},{"all":{"title":"Keynote : Reinventing software quality","type":"keynote","speakers":["Gojko Adciz"]}},{"Cervin":{"speakers":["Christophe Ney"],"room":"Cervin","slot":"1","title":"Outils informatiques agiles au sein d'une agence digitale","id":"79"},"Kilimanjaro 3":{"speakers":["Pierre Morize"],"room":"Kilimanjaro 3","slot":"1","title":"Construire une vision partagée","id":"72"},"Mont Blanc 1":{"speakers":["Thomas Ducrocq","Andréane Vuillamy"],"room":"Mont Blanc 1","slot":"1","title":"Comment gérer l’absence des Product Owner ?","id":"68"},"Makalu":{"speakers":["Jean-François Jagodzinski"],"room":"Makalu","slot":"1","title":"L'agilité pour les nuls","id":"65"},"Mont Blanc 4":{"speakers":["Cyril Megard","Emmanuel Etasse"],"room":"Mont Blanc 4","slot":"1","title":"C'est grave Docteur Rétro ?","id":"39"},"Mont Blanc 3+2":{"speakers":["Laurent Tardif","Sandrine Montusclat"],"room":"Mont Blanc 3+2","slot":"1","title":"Strategie de tests","id":"31"},"Everest":{"speakers":["Rémy Sanlaville","Johan Martinsson"],"room":"Everest","slot":"1","title":"Changer pour mieux coder","id":"26"},"Kilimanjaro 1":{"speakers":["Jean Dupuis","Christophe  Duplaix"],"room":"Kilimanjaro 1","slot":"1","title":"Product Owner : comment tirer toute la puissance de l'agilité","id":"16"},"Auditorium":{"speakers":["Alain  Delafosse","Nicolas Capponi"],"room":"Auditorium","slot":"1","title":"DevOps@Kelkoo","id":"10"}},{"Everest":{"speakers":["Emmanuel Gaillot","Jonathan Perret"],"room":"Everest","slot":"2","title":"Mon Binôme m'a tuer","id":"74"},"Mont Blanc 4":{"speakers":["Vincent Daviet"],"room":"Mont Blanc 4","slot":"2","title":"Collaborer, et si on improvisait ?","id":"50"},"Cervin":{"speakers":["Thierry Vallée","Laurence Hanot"],"room":"Cervin","slot":"2","title":"Dis, monsieur, c'est quoi être agile ?","id":"36"},"Kilimanjaro 3":{"speakers":["Laurent Dubost"],"room":"Kilimanjaro 3","slot":"2","title":"REX : 10 bonnes raisons de ne pas choisir AGILE ?","id":"32"},"Mont Blanc 1":{"speakers":["Yann Poles"],"room":"Mont Blanc 1","slot":"2","title":"La fleur de lotus ou comment redynamiser vos rétrospectives","id":"30"},"Makalu":{"speakers":["Romain Couturier"],"room":"Makalu","slot":"2","title":"Il était une fois la vie d’un Product Owner","id":"18"},"Auditorium":{"speakers":["Etienne Charignon"],"room":"Auditorium","slot":"2","title":"Retour d’expérience : Agile contre Cycle en V : Le match","id":"17"},"Mont Blanc 3+2":{"speakers":["Laurent  Leseigneur","Emmanuel Picon"],"room":"Mont Blanc 3+2","slot":"2","title":"Don Quichotte et Sancho testa","id":"8"},"Kilimanjaro 1":{"speakers":["Alexis Monville","Bruno Sbille"],"room":"Kilimanjaro 1","slot":"2","title":"Duo de retour d’expérience sauce aigre douce ","id":"3"}},{"all":{"title":"Repas"}},{"all":{"title":"Session Plénière: le mot des organisateurs & Samse"}},{"all":{"title":"Keynote : Rompez les amarres !!","type":"keynote","speakers":["Laurent Sarrazin"]}},{"Everest":{"speakers":["Krystel Guetat","Fabien Gachet"],"room":"Everest","slot":"3","title":"Processus de définition des besoins pour le Projet CAISSE de La Boîte à Outils","id":"70"},"Mont Blanc 4":{"speakers":["Cédric Joseph","Julie Boichot"],"room":"Mont Blanc 4","slot":"3","title":"XP Game","id":"69"},"Kilimanjaro 1":{"speakers":["Guillaume Saint Etienne"],"room":"Kilimanjaro 1","slot":"3","title":"BDD: retour sur 3 ans de pratique avec Specflow","id":"64"},"Auditorium":{"speakers":["Alexandre Boutin","Bruno Sbille"],"room":"Auditorium","slot":"3","title":"Les Men In Black font de l'Agile","id":"42"},"Mont Blanc 3+2":{"speakers":["Fabrice Chaminand","Laurent Dupanloup"],"room":"Mont Blanc 3+2","slot":"3","title":"Qualité: Stop à la procrastination","id":"29"},"Makalu":{"speakers":["Thierry Cros"],"room":"Makalu","slot":"3","title":"Différences entre approches agiles","id":"28"},"Cervin":{"speakers":["Antoine Vernois","Fabrice Aimetti","Philippe Launay"],"room":"Cervin","slot":"3","title":"Sky Castle Game","id":"15"},"Kilimanjaro 3":{"speakers":["Caroline Damour-Nobi","Emilie Franchomme"],"room":"Kilimanjaro 3","slot":"3","title":"Des mots, des maux ? Démo !","id":"7"},"Mont Blanc 1":{"speakers":["Laurent Morisseau"],"room":"Mont Blanc 1","slot":"3","title":"Challenge Kanban","id":"2"}},{"all":{"title":"Pause café"}},{"Mont Blanc 4":{"speakers":[],"room":"Mont Blanc 4","slot":"4","title":"XP Game, 2e partie","id":""},"Kilimanjaro 1":{"speakers":[],"room":"Kilimanjaro 1","slot":"4","title":"BDD: retour sur 3 ans de pratique avec Specflow, 2e partie","id":""},"Cervin":{"speakers":[],"room":"Cervin","slot":"4","title":"Sky Castle Game 2e partie","id":""},"Mont Blanc 1":{"speakers":["Laurent Morisseau"],"room":"Mont Blanc 1","slot":"4","title":"Challenge Kanban 2e partie","id":""},"Everest":{"speakers":["Christophe Grand","Laurent Petit"],"room":"Everest","slot":"4","title":"Clojure Hands On","id":"78"},"Auditorium":{"speakers":["Laurent Sarrazin","Sylvaine Pascual"],"room":"Auditorium","slot":"4","title":"Sweet Rupture, en version OST","id":"53"},"Kilimanjaro 3":{"speakers":["Jonathan Le Lous","Manuel Vacelet"],"room":"Kilimanjaro 3","slot":"4","title":"Existe-t-il une agilité open source ?","id":"40"},"Makalu":{"speakers":["Jean Claude Grosjean"],"room":"Makalu","slot":"4","title":"AgileUX (User Experience): Du Besoin au Sketching","id":"33"},"Mont Blanc 3+2":{"speakers":["Sylvain François"],"room":"Mont Blanc 3+2","slot":"4","title":"Les tests et l'agilité : la vraie vie","id":"24"}},{"Auditorium":{"speakers":["Oana Juncu"],"room":"Auditorium","slot":"5","title":"Lean Startup","id":"80"},"Everest":{"speakers":[],"room":"Everest","slot":"5","title":"Clojure Hands On, 2e partie","id":""},"Kilimanjaro 3":{"speakers":["Xavier Nopre"],"room":"Kilimanjaro 3","slot":"5","title":"Ingénierie agile, outils et bonnes pratiques : n'oubliez pas vos développeurs !","id":"76"},"Mont Blanc 4":{"speakers":["Frédéric Dufau-Joël","Elisabeth Paccard"],"room":"Mont Blanc 4","slot":"5","title":"Histoire de Kalitou, transformateur d’entreprise.","id":"67"},"Kilimanjaro 1":{"speakers":["Thierry Montulé"],"room":"Kilimanjaro 1","slot":"5","title":"Scrum aux frontières de la psychologie sociale","id":"57"},"Mont Blanc 3+2":{"speakers":["Mathieu Cans","Olivier Gauchard"],"room":"Mont Blanc 3+2","slot":"5","title":"Mise en place du TDD: du mythe à la réalité","id":"49"},"Makalu":{"speakers":["Nicolas Capponi","Guillaume Gardais"],"room":"Makalu","slot":"5","title":"Well-crafted software: un code maintenable avec le \"principe de responsabilité unique\"","id":"37"},"Cervin":{"speakers":["Véronique Mosnier"],"room":"Cervin","slot":"5","title":"Scrum à Kanban : 3 retours d’expériences","id":"21"},"Mont Blanc 1":{"speakers":["Rémy Génin"],"room":"Mont Blanc 1","slot":"5","title":"Les KPI agiles","id":"13"}},{"all":{"title":"Apéro offert par le Club Agile Rhone Alpes"}}]};

var room_map = {
    "Auditorium":{"id": 0, "capacity" : 530},
    "Makalu": {"id":1, "capacity" : 110},  
    "Kilimanjaro 1": {"id":2, "capacity" : 50},
    "Kilimanjaro 3": {"id":3, "capacity" : 50},
    "Mont Blanc 1": {"id":4, "capacity" : 25},
    "Mont Blanc 3+2": {"id":5, "capacity" : 50},
    "Mont Blanc 4": {"id":6, "capacity" : 25},
    "Cervin": {"id":7, "capacity" : 40},
    "Everest": {"id":8, "capacity" : 40}
};

var slot_hours = [
    "8h00",
    "8h30",
    "9h00",
    "10h00",
    "10h50",
    "11h10",
    "12h00",
    "13h35",
    "13h45",
    "14h50",
    "15h40",
    "16h10",
    "17h00",
    "17h20",
    "18h30"
];

format_program(program);

function format_program(program) {
    var slot_id = 0;
    var previous_was_plenary = false;
    $.each(program["slots"], function(islot, slot) {
        if (!slot.all && !previous_was_plenary) {
            $('#program_content').append(change_room(slot_id));
            slot_id++;
        }

        var session_html = '<td>'+slot_hours[slot_id]+'</td>';
        format_slot(slot_id, slot, session_html);
        
        previous_was_plenary = false;
        if (slot.all) {
            previous_was_plenary = true;
        }
        slot_id++;
    });
}

function format_slot(slot_id, slot, session_html) {
    if (slot.all) {
        format_plenary(session_html, slot);
    } else {
        prefill_empty_cells(session_html, slot_id);

        $.each(slot, function (room, session) {
            $('#'+slot_id+'_'+room_map[room].id).append(format_session(session));
        });
    }
}

function get_rooms_slot() {
    var session_html = '<td> </td>';
    $.each(room_map, function (room_name, room) {
        session_html += '<td>'+room_name+'<br />('+room.capacity+' places)</td>';
    });
    return '<tr class="room_desc">'+session_html+'</tr>';
}

function format_plenary(session_html, slot) {
    var it_was_keynote = false;
    // there is only one key
    $.each(slot, function (room, session) {
        if (session.type == 'keynote') {
            it_was_keynote = true;
        }
        session_html += '<td colspan="9" class="plenary '+session.type+'">'+format_session(session)+'</td>';
    });
    $('#program_content').append('<tr>'+session_html+'</tr>');

    if (it_was_keynote) {
        $('#program_content').append(get_rooms_slot());
    }
}

function change_room(slot_id) {
    var session_html = '<td>'+slot_hours[slot_id]+'</td>';
    session_html += '<td colspan="9">Changement de salle</td>';
    return '<tr class="change_room">'+session_html+'</tr>';
}

function prefill_empty_cells(session_html, slot_id) {
    $.each(room_map, function (room_name, room) {
        session_html += '<td id="'+slot_id+'_'+room.id+'">&nbsp;</td>';
    });
    $('#program_content').append('<tr>'+session_html+'</tr>');    
}

function format_session(session) {
    var session_title = '<span class="session_title">'+session['title']+'</span> ';
    var session_url   = session_title;
    if (session.id) {
        session_url = '<a href="#'+session['id']+'">'+session_title+'</a>';
    }
    
    session_content = session_url;
    if (session['speakers']) {
        session_content += '<span class="session_speakers">'+session['speakers'].join(', ')+'</span>';
    }
    return session_content;
}
